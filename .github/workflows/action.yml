name: Lint Python Code

on:
  push:
    branches:
      - "**"

jobs:
  lint:
    name: Lint with Flake8
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python version from pyproject.toml
        id: pyversion
        run: |
          PY_VERSION=$(grep -A 1 '\[project\]' pyproject.toml | grep requires-python | sed -E "s/.*'>=([0-9]+\.[0-9]+).*/\1/" || echo "3.11")
          echo "Using Python $PY_VERSION"
          echo "version=$PY_VERSION" >> $GITHUB_OUTPUT

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ steps.pyversion.outputs.version }}

      - name: Install flake8
        run: |
          python -m pip install --upgrade pip
          pip install flake8

      - name: Run flake8 and warn
        run: |
          echo "Running flake8..."
          flake8 . || echo "⚠️ Flake8 found issues, but continuing workflow."
        continue-on-error: true
